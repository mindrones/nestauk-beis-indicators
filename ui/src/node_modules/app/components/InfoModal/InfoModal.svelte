<script>
	import * as _ from 'lamb';

	import ExternalLink from '../ExternalLink.svelte';
	import PolymorphicString from './PolymorphicString.svelte';
	import PolymorphicURL from './PolymorphicURL.svelte';

	const noop = () => {};
	const formatDate = _.pipe([
		String,
		s => `${s.slice(0, 4)}-${s.slice(4, 6)}-${s.slice(6, 8)}`
	]);

	const query_types = ['POST', 'Â ElasticSearch', 'Neo4j', 'MySQL'];

	export let api_doc_url;
	export let api_type;
	export let auth_provider;
	export let data_date;
	export let description_long;
	export let endpoint_url;
	export let is_experimental;
	export let is_public;
	export let query;
	export let region;
	export let source_name;
	export let source_url;
	export let url;
	export let warning;
	export let year_extent;

	$: date = data_date && formatDate(data_date);
	$: regionType = region.type.replace('Region', '').toUpperCase();
</script>

<div class='modal' on:click>
	<div
		class='panel'
		on:click|stopPropagation={noop}
	>
		<h2>About the data</h2>

		{#if description_long}
			<p class='longDesc'>{description_long}</p>
		{/if}

		{#if url}
		<p>
			<b>Indicator download:</b>
			<ExternalLink href={url} />
		</p>
		{/if}

		{#if date}
			<p><b>Data downloaded on date:</b> {date}</p>
		{/if}

		<p>
			<b>Available years:</b> {year_extent[0]}
			{#if year_extent[0] !== year_extent[1]}
			- {year_extent[1]}
			{/if}
		</p>

		<p>
			<b>Region type:</b>
			<span>{regionType}</span>
			{#if region.level}<span>(level: {region.level})</span>{/if}
		</p>

		{#if is_experimental}
		<p>
			Note that this indicator is <b>experimental</b>.
		</p>
		{/if}

		{#if warning}
		<p>
			<b>Warning:</b>
			<span>{warning}</span>
		</p>
		{/if}

		{#if source_name}
			<PolymorphicString item={source_name} title='Source name' />
		{/if}
		{#if source_url}
			<PolymorphicURL item={source_url} title='Source' />
		{/if}
		{#if api_doc_url}
			<PolymorphicURL item={api_doc_url} title='Source documentation' />
		{/if}
		{#if endpoint_url}
			<PolymorphicURL item={endpoint_url} title='Source data' />
			{/if}
		{#if api_type}
			<PolymorphicString item={api_type} title='API type' />
		{/if}
		{#if query}
			<PolymorphicString item={query} title='Query' />
		{/if}
		{#if !_.isUndefined(is_public) && !is_public}
		<p>
			<b>Access:</b>
			<span>The dataset originally used to create this indicator is not public. </span>
			{#if auth_provider}
			<span>Please contact {auth_provider} for more details about access.</span>
			{/if}
		</p>
		{/if}
	</div>
</div>

<style>
	.modal {
		align-items: center;
		background-color: rgba(255, 255, 255, 0.5);
		display: flex;
		height: 100%;
		justify-content: space-around;
		position: absolute;
		width: 100%;
		cursor: pointer;
	}

	.panel {
		background-color: white;
		border: 1px solid lightgrey;
		box-shadow: var(--box-shadow-xy);
		max-height: 80%;
		max-width: 800px;
		padding: 1rem;
		overflow-y: auto;
		cursor: auto;
	}

	.longDesc {
		margin-bottom: 1rem;
	}

	b {
		font-family: 'Open Sans Regular', sans-serif;
		margin-right: 0.25rem;
	}

	ul {
		margin-left: 1.5rem;
	}
</style>
